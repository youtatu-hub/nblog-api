<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.net.perfect.storage.domain.onlinehistory.mapper.Dt50OnlineHistoryMapper">

    <resultMap id="Dt50OnlineHistoryResult" type="cn.net.perfect.storage.domain.onlinehistory.po.Dt50OnlineHistory">
        <result property="logTime" column="log_time"/>
        <result property="logDay" column="log_day"/>
        <result property="insertTime" column="insert_time"/>
        <result property="onlineStatus" column="online_status"/>
        <result property="tid" column="tid"/>
    </resultMap>

    <select id="getTerminalHistoryOnlineDays" resultMap="Dt50OnlineHistoryResult">
        select
            distinct tid, log_day, online_status
        from online_histroy_log
        <where>
            1 = 1
            and log_day >= TODAY() - 15d
            and tid in
            <foreach collection="query.terminalIdList" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </where>
        PARTITION BY tid, log_day
    </select>

</mapper>